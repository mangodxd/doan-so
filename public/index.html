<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đoán Số</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<button id="rules-btn" class="floating-rules">?</button>

    <div id="toast-container" class="toast-container"></div>

    <div class="view view-container" data-name="lobby">
        <h1>Đoán Số</h1>
        <div class="card">
            <input type="text" id="username" placeholder="Nhập tên của bạn" maxlength="15">
            <div class="settings-group">
                <label for="digit-select">Số lượng chữ số:</label>
                <select id="digit-select">
                    <option value="3">3 chữ số</option>
                    <option value="4">4 chữ số</option>
                    <option value="5" selected>5 chữ số</option>
                    <option value="6">6 chữ số</option>
                </select>
            </div>
            <div class="lobby-actions">
                <button id="create-btn">Tạo Phòng</button>
                <div class="divider">HOẶC</div>
                <input type="text" id="room-input" placeholder="Nhập Mã Phòng">
                <button id="join-btn">Vào Phòng</button>
            </div>
        </div>
    </div>

    <div class="view view-container hidden" data-name="setup">
        <div class="card">
            <p>Mã Phòng: <strong id="setup-room-id"></strong></p>
            <p id="setup-status">Đang chờ đối thủ...</p>
            <div id="secret-form" class="hidden">
                <p id="digit-hint" class="hint-text"></p>
                <input type="text" id="secret-input" placeholder="Nhập số bí mật" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                <button id="confirm-secret-btn">Xác Nhận</button>
            </div>
        </div>
    </div>

    <div class="view view-container hidden" data-name="game">
        <header>
            <div class="info">
                Phòng: <strong id="game-room-id"></strong> | 
                Chữ số: <strong id="game-digits"></strong> | 
                Đối thủ: <strong id="opponent-name"></strong>
            </div>
            <div class="my-secret-display">
                Số của bạn: <strong id="my-secret-number">----</strong>
            </div>
            <div class="controls">
                <button id="guess-btn">Đoán Số</button>
                <button id="surrender-btn" class="danger">Đầu Hàng</button>
            </div>
        </header>

        <main class="game-grid">
            <section class="timeline-panel">
                <div id="timeline" class="history-feed"></div>
                <div id="action-area" class="action-box">
                    <div id="asking-ui" class="hidden">
                        <input type="text" id="question-input" placeholder="Hỏi một câu hỏi Đúng/Sai...">
                        <button id="ask-btn">Hỏi</button>
                    </div>
                    <div id="answering-ui" class="hidden">
                        <p>Đối thủ đã hỏi. Hãy trả lời:</p>
                        <button class="answer-btn" data-val="ĐÚNG">ĐÚNG</button>
                        <button class="answer-btn" data-val="SAI">SAI</button>
                    </div>
                    <div id="waiting-ui"><p>Đang chờ đối thủ...</p></div>
                </div>
            </section>
            <aside class="chat-panel">
                <h3>Chat</h3>
                <div id="chat-feed" class="history-feed"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Nhập tin nhắn...">
                    <button id="chat-send-btn">Gửi</button>
                </div>
            </aside>
        </main>
    </div>

    <dialog id="guess-modal" class="card">
        <h2>Đưa Ra Dự Đoán</h2>
        <p>Note: Nếu đoán sai bạn sẽ bị mất lượt!</p>
        <p id="guess-digit-hint" class="hint-text"></p>
        <input type="text" id="final-guess-input" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
        <button id="submit-guess-btn">Chốt</button>
        <button id="cancel-guess-btn">Hủy</button>
    </dialog>

    <dialog id="game-over-modal" class="card">
        <h2 id="winner-text"></h2>
        <div id="reveal-area"></div>
        <button id="home-btn">Về Sảnh Chờ</button>
    </dialog>

    <dialog id="rules-modal" class="card" style="max-width: 500px; text-align: left;">
        <h2>Luật Chơi</h2>
        <div style="text-align: left; line-height: 1.6; margin-bottom: 20px;">
            <p>1. <strong>Thiết lập:</strong> Có 2 người chơi. Mỗi người chơi chọn một dãy số bí mật (3, 4, 5, 6 chữ số).</p>
            <p>2. <strong>Mục tiêu:</strong> Đoán chính xác dãy số của đối thủ trước khi họ đoán ra số của bạn.</p>
            <p>3. <strong>Tiến trình:</strong> Hai bên thay phiên nhau:</p>
            <ul style="margin-left: 20px;">
                <li><strong>Hỏi:</strong> Đưa ra câu hỏi Có/Không (Ví dụ: "Số đó có chữ số 5 không?").</li>
                <li><strong>Trả lời:</strong> Đối thủ trả lời thành thật bằng nút ĐÚNG/SAI.</li>
            </ul>
            <p>4. <strong>Đoán số:</strong> Bạn có thể dùng nút <strong>Đoán Số</strong> bất cứ khi nào đến lượt. 
               <br><span style="color: #ff5454;">⚠️ Lưu ý: Nếu đoán sai, bạn sẽ mất lượt ngay lập tức!</span></p>
        </div>
        <button id="close-rules-btn">Bắt Đầu Chơi</button>
    </dialog>

    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>